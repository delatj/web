<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dron Pilot - Ready to Program</title>
    <style>
        :root {
            --primary: #2ecc71;
            --danger: #e74c3c;
            --dark: #1a1a1a;
            --panel: #2c3e50;
            --dron-front: #e74c3c;
            --base-color: #3498db;
        }
        body { background: var(--dark); color: white; margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }

        /* --- PANEL LATERAL --- */
        .sidebar { width: 320px; background: var(--panel); padding: 15px; display: flex; flex-direction: column; box-shadow: 5px 0 15px rgba(0,0,0,0.3); z-index: 10; overflow-y: auto; }
        #score-container { font-size: 1.2rem; font-weight: bold; text-align: center; background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; margin-bottom: 10px; border-bottom: 3px solid var(--primary); }
        
        /* Consola en blanco al inicio */
        textarea { height: 160px; width: 100%; background: #111; color: #00ff00; border: 1px solid #444; border-radius: 6px; padding: 10px; font-family: 'Courier New', monospace; resize: none; outline: none; box-sizing: border-box; font-size: 0.9rem; }
        
        .button-group { display: flex; gap: 8px; margin: 10px 0; }
        .btn-run { flex: 2; background: var(--primary); border: none; padding: 10px; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; }
        .btn-clear { flex: 1; background: var(--danger); border: none; padding: 10px; border-radius: 4px; color: white; font-weight: bold; cursor: pointer; }

        .ejemplo-codigo { background: #111; padding: 10px; border-radius: 6px; border-left: 3px solid #f1c40f; margin-bottom: 10px; }
        .ejemplo-codigo h5 { margin: 0 0 5px 0; font-size: 0.75rem; color: #f1c40f; text-transform: uppercase; }
        .ejemplo-codigo code { font-family: monospace; font-size: 0.8rem; color: #ccc; white-space: pre; }

        .guia-comandos { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; font-size: 0.75rem; line-height: 1.3; }

        /* --- MUNDO 3D (PISTA PEQUEÑA) --- */
        .viewport { flex-grow: 1; position: relative; perspective: 1200px; background: #222; display: flex; justify-content: center; align-items: center; }
        #mundo { width: 600px; height: 500px; position: relative; transform-style: preserve-3d; transform: rotateX(55deg) rotateZ(-20deg); }
        .suelo { position: absolute; width: 800px; height: 800px; background: #eee; top: -150px; left: -100px; background-image: radial-gradient(#ccc 1px, transparent 1px); background-size: 40px 40px; border: 2px solid #ddd; }
        
        #meta { position: absolute; width: 80px; height: 80px; border: 5px solid var(--primary); border-radius: 50%; background: rgba(46, 204, 113, 0.2); box-shadow: 0 0 15px var(--primary); transition: all 0.5s ease; }
        #base-home { position: absolute; width: 50px; height: 50px; border: 2px solid var(--base-color); display: flex; align-items: center; justify-content: center; color: var(--base-color); font-weight: bold; font-size: 9px; transition: all 0.6s ease; }

        /* DRON */
        #dron-container { position: absolute; transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1); transform-style: preserve-3d; }
        #dron-modelo { width: 40px; height: 40px; background: #3498db; border-radius: 8px; position: relative; transform-style: preserve-3d; transition: transform 0.5s; }
        #dron-modelo::before { content: ""; position: absolute; top: 0; left: 10px; width: 20px; height: 8px; background: var(--dron-front); border-radius: 3px 3px 0 0; }
        .helice { position: absolute; width: 30px; height: 2px; background: #000; top: 50%; left: 50%; margin-left: -15px; animation: spin 0.1s infinite linear; display: none; }
        @keyframes spin { to { transform: rotateZ(360deg); } }
    </style>
</head>
<body>

    <div class="sidebar" id="panel-lateral">
        <div id="score-container">SCORE: <span id="val-puntos">0</span></div>
        
        <textarea id="consola" placeholder="Escribe aquí tus comandos... (ej: despegar)"></textarea>

        <div class="button-group">
            <button class="btn-run" onclick="iniciarMision()">EJECUTAR</button>
            <button class="btn-clear" onclick="limpiarConsola()">BORRAR</button>
        </div>

        <div class="ejemplo-codigo">
            <h5>Ejemplo de Vuelo:</h5>
            <code>despegar
avanzar 150
girar derecha
avanzar 100
aterrizar</code>
        </div>

        <div class="guia-comandos">
            <b>Comandos:</b><br>
            - <b>despegar</b> / <b>aterrizar</b><br>
            - <b>avanzar [px]</b><br>
            - <b>girar derecha/izquierda</b> (90°)<br>
            <small>* Fallar te devuelve a la última base exitosa.</small>
        </div>
    </div>

    <div class="viewport">
        <div id="mundo">
            <div class="suelo"></div>
            <div id="base-home" style="left: 45px; top: 45px;">HOME</div>
            <div id="meta" style="left: 250px; top: 250px;"></div>
            
            <div id="dron-container" style="left: 50px; top: 50px;">
                <div id="dron-modelo">
                    <div class="helice" style="top:0; left:0"></div>
                    <div class="helice" style="top:0; left:100%"></div>
                    <div class="helice" style="top:100%; left:0"></div>
                    <div class="helice" style="top:100%; left:100%"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Lógica de funcionamiento del dron (idéntica a la anterior pero con textarea limpia)
        let posX = 50, posY = 50, posZ = 0, angulo = 0, puntos = 0;
        let lastBaseX = 50, lastBaseY = 50;
        let metaX = 250, metaY = 250;

        function limpiarConsola() { document.getElementById('consola').value = ""; }

        async function iniciarMision() {
            const lineas = document.getElementById('consola').value.toLowerCase().split('\n');
            for(let cmd of lineas) {
                if(cmd.trim()) await ejecutar(cmd.trim());
            }
        }

        function ejecutar(cmd) {
            return new Promise(resolve => {
                const partes = cmd.split(" ");
                const accion = partes[0];
                const valor = parseInt(partes[1]) || 0;

                if(accion === "despegar") {
                    posZ = 80;
                    document.querySelectorAll('.helice').forEach(h => h.style.display = 'block');
                }
                else if(accion === "aterrizar") {
                    posZ = 0;
                    actualizarDron();
                    setTimeout(async () => {
                        const exito = verificarAterrizaje();
                        if(!exito) await volverABase();
                        resolve();
                    }, 800);
                    return;
                }
                else if(accion === "girar") {
                    if(partes[1] === "derecha") angulo += 90;
                    if(partes[1] === "izquierda") angulo -= 90;
                }
                else if(accion === "avanzar") {
                    const rad = (angulo - 90) * (Math.PI / 180); 
                    posX += Math.cos(rad) * valor;
                    posY += Math.sin(rad) * valor;
                }
                actualizarDron();
                setTimeout(resolve, 800); 
            });
        }

        function actualizarDron() {
            const container = document.getElementById('dron-container');
            container.style.left = posX + "px";
            container.style.top = posY + "px";
            container.style.transform = `translate3d(0, 0, ${posZ}px)`;
            document.getElementById('dron-modelo').style.transform = `rotateZ(${angulo}deg)`;
        }

        function verificarAterrizaje() {
            const dist = Math.sqrt(Math.pow(posX - metaX, 2) + Math.pow(posY - metaY, 2));
            if(dist < 55) {
                puntos++;
                document.getElementById('val-puntos').innerText = puntos;
                lastBaseX = posX; lastBaseY = posY;
                actualizarPosicionBase();
                actualizarColorPanel();
                moverMeta();
                document.querySelectorAll('.helice').forEach(h => h.style.display = 'none');
                return true;
            }
            return false;
        }

        function actualizarPosicionBase() {
            const base = document.getElementById('base-home');
            base.style.left = (lastBaseX - 5) + "px";
            base.style.top = (lastBaseY - 5) + "px";
        }

        async function volverABase() {
            posZ = 100; actualizarDron();
            await new Promise(r => setTimeout(r, 600));
            posX = lastBaseX; posY = lastBaseY; angulo = 0;
            actualizarDron();
            await new Promise(r => setTimeout(r, 800));
            posZ = 0; actualizarDron();
            document.querySelectorAll('.helice').forEach(h => h.style.display = 'none');
        }

        function moverMeta() {
            do {
                metaX = Math.floor(Math.random() * 400) + 50;
                metaY = Math.floor(Math.random() * 350) + 50;
            } while (Math.sqrt(Math.pow(metaX - lastBaseX, 2) + Math.pow(metaY - lastBaseY, 2)) < 120);
            const meta = document.getElementById('meta');
            meta.style.left = metaX + "px";
            meta.style.top = metaY + "px";
        }

        function actualizarColorPanel() {
            const panel = document.getElementById('panel-lateral');
            let color = "#2c3e50"; let txt = "#fff";
            if(puntos >= 10 && puntos <= 20) color = "#2980b9"; 
            else if(puntos >= 21 && puntos <= 30) color = "#27ae60"; 
            else if(puntos >= 31 && puntos <= 40) { color = "#f1c40f"; txt = "#000"; }
            else if(puntos >= 41 && puntos <= 50) color = "#e67e22"; 
            else if(puntos >= 51 && puntos <= 60) color = "#c0392b"; 
            panel.style.backgroundColor = color; panel.style.color = txt;
        }
    </script>
</body>
</html>