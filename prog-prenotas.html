<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Generador de Prenotas - Tecnolog√≠a</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; color: #333; }
        .container { max-width: 950px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #1a5f7a; border-bottom: 3px solid #1a5f7a; padding-bottom: 10px; text-align: center; }
        
        textarea { width: 100%; border: 1px solid #ccc; border-radius: 6px; padding: 12px; font-family: inherit; font-size: 14px; box-sizing: border-box; }
        .setup-section, .main-section { margin-bottom: 30px; }
        
        .items-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px; }
        .item-group { padding: 15px; border-radius: 8px; }
        .buenos { background-color: #e8f5e9; border: 1px solid #c8e6c9; }
        .malos { background-color: #fff3e0; border: 1px solid #ffe0b2; }
        
        label { display: block; margin: 10px 0; cursor: pointer; padding: 8px; border-radius: 4px; background: rgba(255,255,255,0.5); border: 1px solid transparent; }
        label:hover { border-color: #999; background: white; }

        .controls { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
        button { padding: 12px 20px; cursor: pointer; border: none; border-radius: 6px; font-weight: bold; }
        .btn-load { background: #1a5f7a; color: white; }
        .btn-nav { background: #607d8b; color: white; }
        .btn-copy { background: #2e7d32; color: white; flex-grow: 1; font-size: 1.1em; }
        .btn-download { background: #6a1b9a; color: white; width: 100%; }

        .result-area { margin-top: 20px; background: #ffffff; border: 2px solid #1a5f7a; padding: 20px; border-radius: 8px; }
        #finalText { white-space: pre-wrap; font-size: 15px; line-height: 1.6; color: #000; }
        .hidden { display: none; }
        .current-info { background: #1a5f7a; color: white; padding: 10px 20px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .section-label { font-weight: bold; margin-top: 15px; display: block; color: #555; }
        .alert-info { background: #fff9c4; padding: 10px; border-radius: 5px; border: 1px solid #fbc02d; margin-top: 10px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <h1>üìù Control de Prenotas Tecnolog√≠a</h1>

    <div id="setup" class="setup-section">
        <h2>Paso 1: Lista de Alumnado</h2>
        <textarea id="rawList" rows="8" placeholder="Pega los nombres aqu√≠ (uno por l√≠nea)..."></textarea>
        <div class="controls">
            <button class="btn-load" onclick="startApp()">Cargar Alumnos y Comenzar</button>
        </div>
    </div>

    <div id="mainApp" class="main-section hidden">
        <div class="current-info">
            <span>Alumno: <strong id="currentStudentName">---</strong></span>
            <span id="counter">0/0</span>
        </div>

        <div class="items-container">
            <div class="item-group buenos">
                <strong>‚úÖ Aspectos Positivos</strong>
                <label><input type="checkbox" class="item" value="est√° trabajando bien"> est√° trabajando bien...</label>
                <label><input type="checkbox" class="item" value="tiene buena actitud"> tiene buena actitud.</label>
                <label><input type="checkbox" class="item" value="se esfuerza pero le cuesta y debe seguir as√≠ sin bajar su ritmo"> se esfuerza pero le cuesta...</label>
            </div>
            <div class="item-group malos">
                <strong>‚ùå Aspectos a Mejorar</strong>
                <label><input type="checkbox" class="item" value="debe trabajar y esforzarse m√°s si quiere aprobar"> debe trabajar m√°s...</label>
                <label><input type="checkbox" class="item" value="tiene mala actitud en clase"> tiene mala actitud.</label>
                <label><input type="checkbox" class="item" value="es absentista"> es absentista.</label>
                <label><input type="checkbox" class="item" value="hay d√≠as que no ha entregado las tareas o las ha entregado mal"> tareas: no entregadas/mal.</label>
            </div>
        </div>

        <span class="section-label">Parte 1 (Enlace):</span>
        <textarea id="part1" rows="3"></textarea>

        <span class="section-label">Parte 2 (Refuerzo):</span>
        <textarea id="part2" rows="3"></textarea>

        <div class="controls">
            <button class="btn-nav" onclick="prevStudent()">‚¨ÖÔ∏è Anterior</button>
            <button class="btn-nav" onclick="nextStudent()">Siguiente ‚û°Ô∏è</button>
            <button class="btn-copy" onclick="copyCurrent()">üìã COPIAR NOTA ACTUAL</button>
        </div>

        <div class="result-area">
            <div id="finalText"></div>
        </div>
        
        <div class="alert-info">
            ‚ö†Ô∏è <strong>Nota:</strong> En la aplicaci√≥n del profesor, al descargar las notas, recuerda marcar <strong>"guardar n√∫meros redondeados"</strong>.
        </div>
        
        <button class="btn-download" onclick="downloadAllHtml()" style="margin-top:20px;">üì• Descargar Informe con Botones de Copia</button>
    </div>
</div>

<script>
    let students = [];
    let currentIndex = 0;
    let dataStore = {};

    const defPart1 = `Buenos d√≠as, en cuanto a las notas de tecnolog√≠a le aporto enlace a v√≠deo donde se explica c√≥mo consultar las notas del cuaderno del alumno en la aplicaci√≥n ipasen. https://www.youtube.com/watch?v=Cuw_tF16s_I`;
    const defPart2 = `Adem√°s tiene la posibilidad de hacer tareas para subir nota que pueden encontrar en la plataforma de trabajo online Classroom o Moodle.`;

    function startApp() {
        const text = document.getElementById('rawList').value.trim();
        if (!text) return alert("Introduce nombres.");
        students = text.split('\n').map(s => s.trim()).filter(s => s !== "");
        document.getElementById('setup').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        showStudent(0);
    }

    function showStudent(index) {
        currentIndex = index;
        document.getElementById('currentStudentName').innerText = students[currentIndex];
        document.getElementById('counter').innerText = `Alumno ${currentIndex + 1} de ${students.length}`;
        const saved = dataStore[students[currentIndex]] || { items: [], p1: defPart1, p2: defPart2 };
        document.querySelectorAll('.item').forEach(cb => cb.checked = saved.items.includes(cb.value));
        document.getElementById('part1').value = saved.p1;
        document.getElementById('part2').value = saved.p2;
        updatePreview();
    }

    function formatItems(items) {
        if (items.length === 0) return "";
        if (items.length === 1) return items[0] + ".";
        
        // Unir todos menos el √∫ltimo con comas, y el √∫ltimo con " y "
        const lastItem = items.pop();
        return items.join(', ') + ' y ' + lastItem + '.';
    }

    function updatePreview() {
        const selectedItems = Array.from(document.querySelectorAll('.item:checked')).map(cb => cb.value);
        const p1 = document.getElementById('part1').value;
        const p2 = document.getElementById('part2').value;
        
        let descripcion = formatItems([...selectedItems]); // Usamos una copia para no alterar el original
        
        dataStore[students[currentIndex]] = { items: selectedItems, p1: p1, p2: p2 };
        document.getElementById('finalText').innerText = `${p1}\n\n${p2}\n\nDescripci√≥n del alumnado: ${descripcion}`;
    }

    document.querySelectorAll('.item, textarea').forEach(el => el.addEventListener('input', updatePreview));

    function nextStudent() { if (currentIndex < students.length - 1) showStudent(currentIndex + 1); }
    function prevStudent() { if (currentIndex > 0) showStudent(currentIndex - 1); }

    function copyCurrent() {
        navigator.clipboard.writeText(document.getElementById('finalText').innerText);
        alert("Copiado al portapapeles.");
    }

    function downloadAllHtml() {
        let content = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Notas de Tecnolog√≠a</title><style>
            body{font-family:sans-serif;background:#f0f2f5;padding:30px;}
            .card{background:white;padding:20px;margin-bottom:25px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1);max-width:800px;margin-left:auto;margin-right:auto;}
            .alert-box{background:#fff9c4; padding:10px; border:1px solid #fbc02d; margin-bottom:20px; text-align:center; border-radius:5px;}
            h3{color:#1a5f7a;margin-top:0;}
            pre{white-space:pre-wrap;background:#f9f9f9;padding:15px;border:1px solid #ddd;border-radius:5px;font-family:inherit;}
            button{background:#2e7d32;color:white;padding:10px 20px;border:none;border-radius:5px;cursor:pointer;font-weight:bold;}
        </style></head><body>
        <div class="alert-box">‚ö†Ô∏è Recordatorio: Al descargar las notas en la aplicaci√≥n del profesor, marcar <strong>"guardar n√∫meros redondeados"</strong>.</div>
        <h1 style="text-align:center;">Listado de Prenotas</h1>`;

        students.forEach(name => {
            const data = dataStore[name] || { items: [], p1: defPart1, p2: defPart2 };
            const descripcion = formatItems([...data.items]);
            const fullText = `${data.p1}\n\n${data.p2}\n\nDescripci√≥n del alumnado: ${descripcion}`;
            
            content += `<div class="card">
                <h3>ALUMNO/A: ${name}</h3>
                <pre id="text-${name.replace(/\s+/g, '')}">${fullText}</pre>
                <button onclick="copyNote('text-${name.replace(/\s+/g, '')}')">üìã Copiar esta nota</button>
            </div>`;
        });

        content += `<script>
            function copyNote(id) {
                const text = document.getElementById(id).innerText;
                navigator.clipboard.writeText(text);
                const btn = event.target;
                const oldText = btn.innerText;
                btn.innerText = "‚úÖ ¬°Copiado!";
                setTimeout(() => btn.innerText = oldText, 1500);
            }
        <\/script></body></html>`;

        const blob = new Blob([content], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'informe_notas_tecnologia.html';
        a.click();
    }
</script>

</body>
</html>