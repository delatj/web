<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulación de Balancín Proporcional</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #cce5ff;
        transition: background 0.8s ease;
        margin: 0;
        padding: 10px;
        display: flex;
        flex-direction: column;
        height: 100vh;
        box-sizing: border-box;
    }

    h1 { margin: 5px 0; font-size: 1.5em; text-align: center; }

    .grid-container {
        display: grid;
        grid-template-columns: 280px 1fr 320px;
        gap: 15px;
        flex: 1;
        margin-top: 10px;
        min-height: 0;
    }

    .panel {
        background: rgba(255, 255, 255, 0.9);
        padding: 12px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        overflow-y: auto;
    }

    .input-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.85em;
    }

    input[type="number"] {
        width: 60px;
        padding: 4px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    /* ZONA 2: SIMULADOR */
    .zona-simulacion {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: white !important;
    }
    svg { width: 100%; max-height: 350px; }

    /* ZONA 3: TEST */
    #zonaTest { font-size: 0.82em; position: relative; }
    .test-bloqueado { opacity: 0.4; pointer-events: none; }

    .opcion {
        display: block;
        background: #fff;
        padding: 5px 10px;
        margin: 3px 0;
        border-radius: 5px;
        border: 1px solid #ddd;
        cursor: pointer;
    }
    
    .instruccion-play { font-size: 0.75em; color: #d32f2f; font-style: italic; }

    .btn-verify {
        background: #27ae60; color: white; border: none; padding: 10px;
        width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px;
    }
    .btn-verify:disabled { background: #ccc; }
    .btn-cargar { background: #4a90e2; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }

    #mensaje { margin-top: 10px; font-size: 0.9em; text-align: center; }
</style>
</head>
<body>

<h1>Ley de la Palanca: Balancín Educativo</h1>

<div class="grid-container">
    
    <div class="panel">
        <h3>1. Parámetros</h3>
        <div class="input-group">
            <span>Peso 1 (kg):</span>
            <div><input type="number" id="in_P1"><button class="btn-cargar" onclick="cargarDato('P1')">OK</button></div>
        </div>
        <div class="input-group">
            <span>Distancia 1 (m):</span>
            <div><input type="number" id="in_d1"><button class="btn-cargar" onclick="cargarDato('d1')">OK</button></div>
        </div>
        <div class="input-group">
            <span>Peso 2 (kg):</span>
            <div><input type="number" id="in_P2"><button class="btn-cargar" onclick="cargarDato('P2')">OK</button></div>
        </div>
        <div class="input-group">
            <span>Distancia 2 (m):</span>
            <div><input type="number" id="in_d2"><button class="btn-cargar" onclick="cargarDato('d2')">OK</button></div>
        </div>
        <button onclick="location.reload()" style="width:100%; margin-top:10px; font-size: 0.8em; cursor:pointer;">Reiniciar Ejercicio</button>
    </div>

    <div class="panel zona-simulacion">
        
        <svg viewBox="0 0 600 400" id="svgSim">
            <line x1="50" y1="300" x2="550" y2="300" stroke="#ccc" stroke-width="2" />
            <polygon points="300,280 280,310 320,310" fill="#333" />
            
            <g id="balancin_grupo">
                <rect id="barra" x="-250" y="-5" width="500" height="10" fill="#8d6e63" />
                
                <rect id="visual_P1" x="-100" y="-20" width="20" height="20" fill="#4a90e2" rx="3" />
                <text id="lbl_P1" x="-100" y="-10" text-anchor="middle" font-weight="bold" font-size="12" fill="white">P1</text>
                
                <rect id="visual_P2" x="100" y="-20" width="20" height="20" fill="#95a5a6" rx="3" />
                <text id="lbl_P2" x="100" y="-10" text-anchor="middle" font-weight="bold" font-size="12" fill="white">P2</text>
            </g>
        </svg>
        <div style="margin-top:10px;">
            <button id="btnPlay" onclick="iniciar()" style="background:#444; color:white; padding:8px 15px; border-radius:5px; cursor:pointer;">▶ Play (Equilibrar)</button>
        </div>
    </div>

    <div class="panel">
        <div id="zonaTest" style="display:none">
            <h3>2. Evaluación</h3>
            <p id="avisoPlay" class="instruccion-play">⚠️ Pulsa Play para desbloquear las opciones.</p>
            
            <div id="contenedorTest" class="test-bloqueado">
                <p id="pregFaltante" style="font-weight:bold;"></p>
                <div id="respuestas1"></div>
                <button id="btnCorregir" class="btn-verify" onclick="corregir()">VERIFICAR</button>
            </div>
            <div id="mensaje"></div>
        </div>
        <div id="avisoCarga" style="color:#888; text-align:center; margin-top:40px; font-size:0.9em;">
            Carga 3 datos para comenzar el análisis.
        </div>
    </div>
</div>

<script>
let datos = { P1: null, d1: null, P2: null, d2: null };
let cargados = [];
let valorFaltanteReal, nombreFaltante;

function cargarDato(id) {
    const input = document.getElementById('in_' + id);
    const val = parseFloat(input.value);
    if (isNaN(val) || val <= 0) return alert("Valor incorrecto.");

    datos[id] = val;
    cargados.push(id);
    input.disabled = true;
    input.nextElementSibling.disabled = true;

    if (cargados.length === 3) finalizarCarga();
}

function finalizarCarga() {
    const todos = ['P1', 'd1', 'P2', 'd2'];
    nombreFaltante = todos.find(x => !cargados.includes(x));
    document.getElementById('in_'+nombreFaltante).disabled = true;

    // Ley de palanca
    if(nombreFaltante === 'P1') datos.P1 = (datos.P2 * datos.d2) / datos.d1;
    if(nombreFaltante === 'd1') datos.d1 = (datos.P2 * datos.d2) / datos.P1;
    if(nombreFaltante === 'P2') datos.P2 = (datos.P1 * datos.d1) / datos.d2;
    if(nombreFaltante === 'd2') datos.d2 = (datos.P1 * datos.d1) / datos.P2;

    valorFaltanteReal = datos[nombreFaltante];

    actualizarVisual();
    document.getElementById('avisoCarga').style.display = 'none';
    document.getElementById('zonaTest').style.display = 'block';
    document.getElementById('pregFaltante').innerText = `¿Cuál es el valor de ${nombreFaltante}?`;
    
    generarOpciones('respuestas1', 'p1', valorFaltanteReal);
}

function generarOpciones(contenedor, name, correcto) {
    let valorC = parseFloat(correcto).toFixed(2);
    let opciones = [valorC];
    while(opciones.length < 5) {
        let error = (parseFloat(correcto) * (Math.random() * 0.7 + 0.6)).toFixed(2);
        if(!opciones.includes(error) && error != valorC) opciones.push(error);
    }
    opciones.sort(() => Math.random() - 0.5);
    document.getElementById(contenedor).innerHTML = opciones.map(o => `
        <label class="opcion"><input type="radio" name="${name}" value="${o}"> ${o}</label>
    `).join('');
}

function actualizarVisual() {
    const escalaDist = 45; // 1m = 45px
    const cx = 300, cy = 280;
    
    // Tamaño proporcional (Área del cuadrado proporcional al peso)
    // Usamos raíz cuadrada para que el lado del cuadrado no crezca demasiado rápido
    const lado1 = Math.sqrt(datos.P1) * 8; 
    const lado2 = Math.sqrt(datos.P2) * 8;

    // Actualizar P1
    const p1Rect = document.getElementById('visual_P1');
    p1Rect.setAttribute('width', lado1);
    p1Rect.setAttribute('height', lado1);
    p1Rect.setAttribute('x', -datos.d1 * escalaDist - lado1/2);
    p1Rect.setAttribute('y', -lado1 - 5);
    
    document.getElementById('lbl_P1').setAttribute('x', -datos.d1 * escalaDist);
    document.getElementById('lbl_P1').setAttribute('y', -lado1/2);

    // Actualizar P2
    const p2Rect = document.getElementById('visual_P2');
    p2Rect.setAttribute('width', lado2);
    p2Rect.setAttribute('height', lado2);
    p2Rect.setAttribute('x', datos.d2 * escalaDist - lado2/2);
    p2Rect.setAttribute('y', -lado2 - 5);

    document.getElementById('lbl_P2').setAttribute('x', datos.d2 * escalaDist);
    document.getElementById('lbl_P2').setAttribute('y', -lado2/2);

    // Inclinación inicial (desequilibrado)
    document.getElementById('balancin_grupo').setAttribute("transform", `translate(${cx},${cy}) rotate(-12)`);
}

function iniciar() {
    if(cargados.length === 3) {
        document.getElementById('contenedorTest').classList.remove('test-bloqueado');
        document.getElementById('avisoPlay').style.display = 'none';
        document.getElementById('balancin_grupo').style.transition = "transform 1.5s ease-out";
        document.getElementById('balancin_grupo').setAttribute("transform", `translate(300,280) rotate(0)`);
    }
}

function corregir() {
    const r1 = document.querySelector('input[name="p1"]:checked');
    if(!r1) return alert("Selecciona una respuesta.");

    document.querySelectorAll('input[type="radio"]').forEach(r => r.disabled = true);
    document.getElementById('btnCorregir').disabled = true;

    let acierto = Math.abs(parseFloat(r1.value) - valorFaltanteReal) < 0.1;

    // Revelar valores en los paquetes
    document.getElementById('lbl_P1').textContent = datos.P1.toFixed(1) + " kg";
    document.getElementById('lbl_P2').textContent = datos.P2.toFixed(1) + " kg";

    if(acierto) {
        document.body.style.background = "#ff4d4d"; // Rojo por acierto
        document.getElementById('mensaje').innerHTML = "<span style='color:white; font-size:1.2em;'>¡LOGRADO! El sistema está en equilibrio.</span>";
    } else {
        document.body.style.background = "#cce5ff"; // Azul por error
        document.getElementById('mensaje').innerHTML = "<span>INCORRECTO. Revisa tus cálculos de momento.</span>";
    }
}
</script>
</body>
</html>